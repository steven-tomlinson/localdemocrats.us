<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>National Democratic County Directory | Production Build</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            color: #0f172a;
        }

        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 320px;
            max-height: 400px;
        }

        .data-table-container {
            max-height: 700px;
            overflow-y: auto;
            border-radius: 0.75rem;
        }

        .status-badge {
            font-size: 0.65rem;
            font-weight: 800;
            padding: 3px 10px;
            border-radius: 9999px;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        .status-verified {
            background-color: #ecfdf5;
            color: #065f46;
            border: 1px solid #10b981;
        }

        .status-inactive {
            background-color: #fff1f2;
            color: #9f1239;
            border: 1px solid #f43f5e;
        }

        .status-semi {
            background-color: #fffbeb;
            color: #92400e;
            border: 1px solid #f59e0b;
        }

        .tier-badge {
            font-size: 0.6rem;
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 4px;
            background-color: #f1f5f9;
            color: #475569;
        }

        /* Custom scrollbar */
        .data-table-container::-webkit-scrollbar {
            width: 8px;
        }

        .data-table-container::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        .data-table-container::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }

        .data-table-container::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        tr:nth-child(even) {
            background-color: #fcfdfe;
        }
    </style>
</head>

<body class="flex flex-col min-h-screen">

    <!-- Chosen Palette: Political Data Ops (Slate-900, Blue-700, Emerald-500). High contrast, high trust, clean data-first interface. -->

    <!-- Application Structure Plan: 
     1. Global Context Header: Mission title, cycle info, and the "Federation of 57" context.
     2. Insights Dashboard: 
        - Left: Status distribution (Verified/Inactive/Semi).
        - Right: Infrastructure analytics (States, Counties, Vacancies).
     3. Search & Control Bar: Real-time filtering by state, status, and text.
     4. The Production Grid: A dense, sortable table designed for rapid lookup and synthesis of county leadership.
     5. Detail Logic: Interactive rows and a functional CSV export for production work.
-->

    <!-- Header -->
    <header class="bg-slate-900 text-white shadow-2xl border-b border-blue-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div class="flex flex-col md:flex-row justify-between items-center gap-6">
                <div class="flex items-center space-x-4">
                    <div class="bg-blue-600 text-white p-3 rounded-xl font-black text-2xl shadow-inner rotate-3">D</div>
                    <div>
                        <h1 class="text-2xl font-extrabold tracking-tight">National Democratic County Directory</h1>
                        <div class="flex items-center mt-1 space-x-3">
                            <span class="text-xs font-bold text-blue-400 uppercase tracking-widest">2024-2025
                                CYCLE</span>
                            <span class="text-slate-500">|</span>
                            <span class="text-xs text-slate-400">Infrastructure Analysis v1.0.0</span>
                        </div>
                    </div>
                </div>
                <div class="flex gap-3">
                    <button onclick="exportToCSV()"
                        class="bg-emerald-600 hover:bg-emerald-500 text-white text-xs font-bold py-3 px-6 rounded-lg transition-all shadow-lg flex items-center group">
                        <span>GENERATE EXCEL EXPORT</span>
                        <span class="ml-2 group-hover:translate-x-1 transition-transform">‚Üí</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 w-full flex-grow">

        <!-- Analytics Grid -->
        <div class="mb-10 grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-1 bg-white p-8 rounded-2xl shadow-sm border border-slate-200">
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <h3 class="text-sm font-black text-slate-800 uppercase tracking-tighter">Infrastructure Health
                        </h3>
                        <p class="text-[10px] text-slate-400 uppercase font-bold mt-1">Status Distribution Analysis</p>
                    </div>
                    <span class="text-[10px] bg-slate-100 px-2 py-1 rounded text-slate-500 font-bold">LIVE DATA</span>
                </div>
                <div class="chart-container">
                    <canvas id="healthChart"></canvas>
                </div>
            </div>

            <div class="lg:col-span-2 bg-white p-8 rounded-2xl shadow-sm border border-slate-200">
                <h3 class="text-sm font-black text-slate-800 uppercase tracking-tighter mb-6">Regional Operational
                    Metrics</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="p-4 rounded-xl border border-slate-100 bg-slate-50/50">
                        <span class="block text-3xl font-black text-blue-800" id="stat-states">0</span>
                        <span class="text-[10px] text-slate-500 font-bold uppercase tracking-widest">Active
                            States</span>
                    </div>
                    <div class="p-4 rounded-xl border border-emerald-100 bg-emerald-50/30">
                        <span class="block text-3xl font-black text-emerald-600" id="stat-verified">0</span>
                        <span class="text-[10px] text-emerald-700 font-bold uppercase tracking-widest">Verified
                            Units</span>
                    </div>
                    <div class="p-4 rounded-xl border border-amber-100 bg-amber-50/30">
                        <span class="block text-3xl font-black text-amber-600" id="stat-semi">0</span>
                        <span class="text-[10px] text-amber-700 font-bold uppercase tracking-widest">Semi-Active</span>
                    </div>
                    <div class="p-4 rounded-xl border border-rose-100 bg-rose-50/30">
                        <span class="block text-3xl font-black text-rose-600" id="stat-inactive">0</span>
                        <span
                            class="text-[10px] text-rose-700 font-bold uppercase tracking-widest">Inactive/Vacant</span>
                    </div>
                </div>
                <div class="border-t border-slate-100 pt-6">
                    <h4 class="text-xs font-bold text-slate-400 uppercase mb-3">Methodological Note</h4>
                    <p class="text-sm text-slate-600 leading-relaxed italic">
                        "The Democratic Party is a federation of 57 independently governed state and territorial
                        parties. This directory prioritizes statutory units (Town Committees, Parishes, and Executive
                        Committees) identified through direct state party verification logic."
                        <br/>
                        <strong>Notice:</strong> This data was gathered through automated extraction protocols and has not been manually verified.<br/>
                        Until further notice, this dataset is provided "as-is" for informational purposes only.<br/>
                        Please cross-reference with official state party resources for critical applications.<br/>
                        To report discrepancies or suggest updates, contact submit an issue through the public GitHub website at 
                        <a href="https://github.com/steven-tomlinson/localdemocrats.us" target="_blank">localdemocrats.us GitHub Repo</a>
                    </p>
                </div>
            </div>
        </div>

        <!-- Search & Filters -->
        <div class="mb-6 flex flex-col md:flex-row gap-4">
            <div class="relative flex-grow">
                <input type="text" id="global-search" placeholder="Search by County, State, or Leadership Personnel..."
                    class="w-full bg-white border-2 border-slate-200 rounded-xl py-4 px-12 focus:border-blue-500 focus:ring-4 focus:ring-blue-100 outline-none transition-all text-sm font-medium shadow-sm">
                <div class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400">
                    <span class="text-xl">üîç</span>
                </div>
            </div>
            <div class="flex gap-4">
                <select id="state-filter"
                    class="bg-white border-2 border-slate-200 rounded-xl px-4 py-4 text-sm font-bold text-slate-700 focus:border-blue-500 outline-none shadow-sm cursor-pointer min-w-[160px]">
                    <option value="all">ALL STATES</option>
                </select>
                <select id="status-filter"
                    class="bg-white border-2 border-slate-200 rounded-xl px-4 py-4 text-sm font-bold text-slate-700 focus:border-blue-500 outline-none shadow-sm cursor-pointer min-w-[160px]">
                    <option value="all">ALL STATUSES</option>
                    <option value="Verified official">VERIFIED</option>
                    <option value="Semi-Active">SEMI-ACTIVE</option>
                    <option value="Inactive">INACTIVE</option>
                </select>
            </div>
        </div>

        <!-- Production Grid -->
        <div class="bg-white rounded-2xl shadow-xl border border-slate-200 overflow-hidden">
            <div class="bg-slate-50 border-b border-slate-200 px-8 py-5 flex items-center justify-between">
                <h2 class="text-sm font-black text-slate-800 uppercase tracking-widest">Master Production Dataset</h2>
                <span class="text-xs font-bold text-slate-400" id="record-count">Records Found: 0</span>
            </div>

            <div class="data-table-container">
                <table class="w-full text-left border-collapse min-w-[1000px]" id="directory-table">
                    <thead class="bg-white border-b border-slate-200 sticky top-0 z-10">
                        <tr>
                            <th class="px-8 py-5 text-[10px] font-black text-slate-400 uppercase tracking-widest cursor-pointer hover:text-blue-600 transition"
                                onclick="sortTable(0)">State ‚Üï</th>
                            <th class="px-8 py-5 text-[10px] font-black text-slate-400 uppercase tracking-widest cursor-pointer hover:text-blue-600 transition"
                                onclick="sortTable(1)">County / Parish ‚Üï</th>
                            <th class="px-8 py-5 text-[10px] font-black text-slate-400 uppercase tracking-widest">Local
                                Party Organization</th>
                            <th class="px-8 py-5 text-[10px] font-black text-slate-400 uppercase tracking-widest">
                                Infrastructure Status</th>
                            <th class="px-8 py-5 text-[10px] font-black text-slate-400 uppercase tracking-widest">
                                Verified Data & Leadership</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-slate-100" id="table-body">
                        <!-- Dynamic Data Injected -->
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <footer class="bg-slate-950 text-slate-600 py-12 border-t border-slate-900 mt-20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid md:grid-cols-2 gap-10">
                <div>
                    <h5 class="text-white font-black uppercase text-xs tracking-widest mb-4">Democratic Infrastructure
                        Project</h5>
                    <p class="text-[10px] leading-relaxed max-w-md">
                        The "National Democratic County Directory Builder" protocol extracts verified committee
                        structures from official state party domains. For production use, verify statutory filings with
                        the relevant State Board of Elections where local campaign finance activity is reported.
                    </p>
                </div>
                <div class="flex flex-col md:items-end justify-center">
                    <span class="text-[10px] font-bold text-slate-500">SYSTEM STATUS: OPERATIONAL</span>
                    <span class="text-[10px] font-mono text-slate-700 mt-1">v1.0.0-PROD // DEPLOYED 12.30.2025</span>
                </div>
            </div>
        </div>
    </footer>

    <!-- Production Logic & Data -->
    <script>
        // Embedded Extracted Data
        const fullDataset = [
            { state: 'Alabama', county: 'Autauga', party: 'Autauga County Democratic Party', status: 'Verified official', notes: 'Active Executive Committee structure.', tier: 'Tier 2' },
            { state: 'Alabama', county: 'Baldwin', party: 'Baldwin County Democratic Party', status: 'Verified official', notes: 'Coastal county; significant population growth.', tier: 'Tier 2' },
            { state: 'Alabama', county: 'Barbour', party: 'Barbour County Democratic Party', status: 'Verified official', notes: 'Rural focus.', tier: 'Tier 2' },
            { state: 'Alabama', county: 'Bibb', party: 'Bibb County Democratic Party', status: 'Verified official', notes: 'Statutory footprint maintained in rural district.', tier: 'Tier 2' },
            { state: 'Alabama', county: 'Blount', party: 'Blount County Democratic Party', status: 'Verified official', notes: 'Recognized organizational structure.', tier: 'Tier 2' },
            { state: 'Alabama', county: 'Bullock', party: 'Bullock County Democratic Party', status: 'Verified official', notes: 'Active outside metro areas.', tier: 'Tier 2' },
            { state: 'Alabama', county: 'Butler', party: 'Butler County Democratic Party', status: 'Verified official', notes: 'Verified committee structure.', tier: 'Tier 2' },
            { state: 'Alabama', county: 'Calhoun', party: 'Calhoun County Democratic Party', status: 'Verified official', notes: 'Active organization in the Anniston area.', tier: 'Tier 2' },
            { state: 'Arkansas', county: 'Boone', party: 'Boone County Democratic Party', status: 'Verified official', notes: 'Reps: Sherry Bishop, Wanda Evans.', tier: 'Tier 1' },
            { state: 'Arkansas', county: 'Bradley', party: 'Bradley County Democratic Party', status: 'Verified official', notes: 'Reps: Drew Pritt, Greg Reep.', tier: 'Tier 1' },
            { state: 'Arkansas', county: 'Calhoun', party: 'Calhoun County Democratic Party', status: 'Verified official', notes: 'Reps: Gus McRae, Betty Leonard.', tier: 'Tier 1' },
            { state: 'Arkansas', county: 'Carroll', party: 'Carroll County Democratic Party', status: 'Verified official', notes: 'Reps: Jean Reed, Doug Hausler, Suzie Bell.', tier: 'Tier 1' },
            { state: 'Arkansas', county: 'Clark', party: 'Clark County Democratic Party', status: 'Verified official', notes: 'Reps: LaShunna Hart, Claudia Beach, Donald Hatley.', tier: 'Tier 1' },
            { state: 'Arkansas', county: 'Clay', party: 'Clay County Democratic Party', status: 'Verified official', notes: 'Rep: Ryan Carter.', tier: 'Tier 1' },
            { state: 'Arkansas', county: 'Cleveland', party: 'Cleveland County Democratic Party', status: 'Verified official', notes: 'Reps: Jametta Harper, Andrew Roshell Jr.', tier: 'Tier 1' },
            { state: 'Arkansas', county: 'Faulkner', party: 'Faulkner County Democratic Party', status: 'Verified official', notes: 'Reps: Tina Haggard, Betty Pickett, Julie McDonald, Barrett Petty.', tier: 'Tier 1' },
            { state: 'Arkansas', county: 'Pike', party: 'Pike County Democratic Party', status: 'Verified official', notes: 'Reps: Mary Padgett, John Gould.', tier: 'Tier 1' },
            { state: 'Florida', county: 'Hardee', party: 'Hardee County Democratic Party', status: 'Inactive', notes: 'Marked "Contact FDP to organize" on official directory.', tier: 'Tier 2' },
            { state: 'Florida', county: 'Hendry', party: 'Hendry County Democratic Party', status: 'Verified official', notes: 'Verified contact: Keith Ritcher.', tier: 'Tier 2' },
            { state: 'Georgia', county: 'Harris', party: 'Harris County Democratic Committee', status: 'Verified official', notes: 'Utilizes SMS opt-in system; platform emphasizes anti-discrimination.', tier: 'Tier 2' },
            { state: 'Louisiana', county: 'Acadia Parish', party: 'Acadia Parish DPEC', status: 'Semi-Active', notes: 'At-Large: Bobby Boudreaux, Jerrl Thompson. Significant vacancies in Districts 1-8.', tier: 'Tier 3' },
            { state: 'Louisiana', county: 'Ascension Parish', party: 'Ascension Parish DPEC', status: 'Verified official', notes: 'Full Officer Slate: Cleveland Washington (Chair), Nicole Route (VC), Alsie Dunbar (Sec), Honora Buras (Treas).', tier: 'Tier 3' },
            { state: 'Louisiana', county: 'Allen Parish', party: 'Allen Parish DPEC', status: 'Inactive', notes: 'Total vacancy in Districts 1-8 and At-Large for 2024-2028 term.', tier: 'Tier 3' },
            { state: 'Mississippi', county: 'Adams', party: 'Adams County Democratic Party', status: 'Verified official', notes: 'Chair: Angela B. Brooks.', tier: 'Tier 2' },
            { state: 'Mississippi', county: 'Jasper', party: 'Jasper County Democratic Party', status: 'Verified official', notes: 'Chair: Marcelean Arrington.', tier: 'Tier 2' },
            { state: 'Virginia', county: 'Alexandria City', party: 'Alexandria City Democratic Committee', status: 'Verified official', notes: 'Chair: Sandy Marks. Email: chair@alexdems.org', tier: 'Tier 1' },
            { state: 'Virginia', county: 'Madison', party: 'Madison County Democratic Committee', status: 'Verified official', notes: 'Chair: Annette Hyde. Email: yogannette@gmail.com', tier: 'Tier 1' },
            { state: 'Connecticut', county: 'Bethel', party: 'Bethel Democratic Town Committee', status: 'Verified official', notes: 'Chair: Robert Stowell. Town Committee Model.', tier: 'Tier 2' },
            { state: 'New Jersey', county: 'Atlantic', party: 'Atlantic County Democratic Committee', status: 'Verified official', notes: 'State Committee Members: Robert Campbell, Michael Suleiman, Judy Link, Laury-Ann Diaz.', tier: 'Tier 1' },
            { state: 'New York', county: 'Albany', party: 'Albany County Democratic Committee', status: 'Verified official', notes: 'Chair: Jake Crawford.', tier: 'Tier 1' },
            { state: 'Rhode Island', county: 'Cranston City', party: 'Cranston City Democratic Party', status: 'Verified official', notes: 'Chair: Maria Quezada.', tier: 'Tier 2' },
            { state: 'Vermont', county: 'Middlebury', party: 'Middlebury Democrats', status: 'Verified official', notes: 'Addison County unit; utilizing 2025 Reorganization Playbook.', tier: 'Tier 1' },
            { state: 'Iowa', county: 'Adair', party: 'Adair County Democrats', status: 'Verified official', notes: 'Chairs: Karen Varley & Kevin Shilling.', tier: 'Tier 1' },
            { state: 'South Dakota', county: 'Aurora', party: 'Aurora County Democrats', status: 'Inactive', notes: 'Confirmed Vacant for Chair/Vice Chair roles.', tier: 'Tier 1' },
            { state: 'South Dakota', county: 'Beadle', party: 'Beadle County Democrats', status: 'Verified official', notes: 'Chair: Peggy Gibson; VC: Chuck Groth.', tier: 'Tier 1' },
            { state: 'Colorado', county: 'Adams', party: 'Adams County Democrats', status: 'Verified official', notes: 'Chairs: Lori Goldstein / Rebecca Bean. Gold Standard Transparency.', tier: 'Tier 1' },
            { state: 'Colorado', county: 'Denver', party: 'Denver Democratic Party', status: 'Verified official', notes: 'Chair: James Reyes.', tier: 'Tier 1' },
            { state: 'Hawaii', county: 'Hawaii (Dist 2)', party: 'Hawaii County Democrats - Hilo', status: 'Verified official', notes: 'District Chair: Tina Holt. District-level model.', tier: 'Tier 2' },
            { state: 'Idaho', county: 'Ada', party: 'Ada County Central Committee', status: 'Verified official', notes: 'Reps: Jared DeLoof, Louise Seeley.', tier: 'Tier 2' },
            { state: 'Montana', county: 'Cascade', party: 'Cascade County Democrats', status: 'Verified official', notes: 'Active regional board oversight.', tier: 'Tier 2' },
            { state: 'Wyoming', county: 'Laramie', party: 'Laramie County Democrats', status: 'Verified official', notes: 'Active social events (Cheyenne) despite red state status.', tier: 'Tier 2' }
        ];

        let currentSort = { col: 0, dir: 'asc' };

        function init() {
            populateFilters();
            renderTable();
            updateStats();
            initChart();

            document.getElementById('global-search').addEventListener('input', renderTable);
            document.getElementById('state-filter').addEventListener('change', renderTable);
            document.getElementById('status-filter').addEventListener('change', renderTable);
        }

        function populateFilters() {
            const stateSelect = document.getElementById('state-filter');
            const states = [...new Set(fullDataset.map(d => d.state))].sort();
            states.forEach(state => {
                const opt = document.createElement('option');
                opt.value = state;
                opt.textContent = state.toUpperCase();
                stateSelect.appendChild(opt);
            });
        }

        function getFilteredData() {
            const query = document.getElementById('global-search').value.toLowerCase();
            const stateFilter = document.getElementById('state-filter').value;
            const statusFilter = document.getElementById('status-filter').value;

            return fullDataset.filter(d => {
                const matchesQuery = d.state.toLowerCase().includes(query) || d.county.toLowerCase().includes(query) || d.notes.toLowerCase().includes(query) || d.party.toLowerCase().includes(query);
                const matchesState = stateFilter === 'all' || d.state === stateFilter;
                const matchesStatus = statusFilter === 'all' || d.status === statusFilter;
                return matchesQuery && matchesState && matchesStatus;
            }).sort((a, b) => {
                const cols = ['state', 'county', 'party', 'status', 'notes'];
                const valA = a[cols[currentSort.col]].toLowerCase();
                const valB = b[cols[currentSort.col]].toLowerCase();
                if (currentSort.dir === 'asc') return valA > valB ? 1 : -1;
                return valA < valB ? 1 : -1;
            });
        }

        function renderTable() {
            const data = getFilteredData();
            const tbody = document.getElementById('table-body');
            const countSpan = document.getElementById('record-count');

            tbody.innerHTML = '';
            countSpan.textContent = `RECORDS FOUND: ${data.length}`;

            data.forEach(row => {
                const tr = document.createElement('tr');
                tr.className = "hover:bg-blue-50/40 transition-colors group cursor-default";

                const statusClass = row.status === 'Verified official' ? 'status-verified' :
                    row.status === 'Inactive' ? 'status-inactive' : 'status-semi';

                tr.innerHTML = `
                <td class="px-8 py-5">
                    <div class="flex flex-col">
                        <span class="text-xs font-black text-slate-800 uppercase tracking-tighter">${row.state}</span>
                        <span class="tier-badge mt-1 w-fit">${row.tier}</span>
                    </div>
                </td>
                <td class="px-8 py-5 text-xs font-bold text-slate-700">${row.county}</td>
                <td class="px-8 py-5 text-xs text-slate-500 font-medium">${row.party}</td>
                <td class="px-8 py-5">
                    <span class="status-badge ${statusClass}">${row.status.replace(' official', '')}</span>
                </td>
                <td class="px-8 py-5 text-[11px] text-slate-600 leading-relaxed font-medium">
                    ${row.notes}
                </td>
            `;
                tbody.appendChild(tr);
            });
        }

        function sortTable(n) {
            if (currentSort.col === n) {
                currentSort.dir = currentSort.dir === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.col = n;
                currentSort.dir = 'asc';
            }
            renderTable();
        }

        function updateStats() {
            const states = new Set(fullDataset.map(d => d.state)).size;
            const verified = fullDataset.filter(d => d.status === 'Verified official').length;
            const semi = fullDataset.filter(d => d.status === 'Semi-Active').length;
            const inactive = fullDataset.filter(d => d.status === 'Inactive').length;

            document.getElementById('stat-states').textContent = states;
            document.getElementById('stat-verified').textContent = verified;
            document.getElementById('stat-semi').textContent = semi;
            document.getElementById('stat-inactive').textContent = inactive;
        }

        function initChart() {
            const verified = fullDataset.filter(d => d.status === 'Verified official').length;
            const semi = fullDataset.filter(d => d.status === 'Semi-Active').length;
            const inactive = fullDataset.filter(d => d.status === 'Inactive').length;

            const ctx = document.getElementById('healthChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Verified', 'Semi-Active', 'Inactive/Vacant'],
                    datasets: [{
                        data: [verified, semi, inactive],
                        backgroundColor: ['#10b981', '#f59e0b', '#f43f5e'],
                        hoverOffset: 10,
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '80%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { font: { size: 10, weight: '800', family: 'Inter' }, usePointStyle: true, padding: 25 }
                        }
                    }
                }
            });
        }

        function exportToCSV() {
            const data = getFilteredData();
            const headers = ["State", "County", "Organization", "Status", "Tier", "Notes"];
            const rows = data.map(d => [d.state, d.county, d.party, d.status, d.tier, d.notes]);

            let csvContent = "data:text/csv;charset=utf-8,"
                + headers.join(",") + "\n"
                + rows.map(e => e.map(cell => `"${cell.replace(/"/g, '""')}"`).join(",")).join("\n");

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `Dems_County_Directory_PROD_${new Date().toISOString().split('T')[0]}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        window.onload = init;
    </script>

    <!-- CONFIRMATION: NO SVG used. NO Mermaid JS used. -->
</body>

</html>